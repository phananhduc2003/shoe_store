package com.fullstack.mystore.controller;

import java.util.Arrays;
import java.util.List;
import java.util.stream.Collectors;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import com.fullstack.mystore.entity.Product;
import com.fullstack.mystore.repository.ProductRepository;


@RestController
public class ProductController {
	@Autowired
	private ProductRepository productRepository;
	

	
	
	public ProductController(ProductRepository productRepository) {
		super();
		this.productRepository = productRepository;
		
	}

	// GET /products
	@GetMapping("home/product")
	public List<Product> allProduct() {
		return productRepository.findAll();
	}
	// GET /products/{id}
	@GetMapping("home/product/{id}")
	public List<Product> getProductById(@PathVariable int id) {
		return productRepository.findProductById(id);
	}
	
	@GetMapping("home/product/filter")
	public List<Product> filterProducts(@RequestParam(required = false) String brandIds,
	        @RequestParam(required = false) String purposeIds) {
		 List<Integer> brandIdList = (brandIds != null && !brandIds.isEmpty())
		            ? Arrays.stream(brandIds.split(","))
		                    .map(Integer::parseInt)
		                    .collect(Collectors.toList())
		            : null;

		    List<Integer> purposeIdList = (purposeIds != null && !purposeIds.isEmpty())
		            ? Arrays.stream(purposeIds.split(","))
		                    .map(Integer::parseInt)
		                    .collect(Collectors.toList())
		            : null;
		    return productRepository.findByFilters(brandIdList, purposeIdList);
	}
	
	
		
	
}
